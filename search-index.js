crystal_doc_search_index_callback({"repository_name":"myip","body":"# myip\n\n返回本机的公网 IP 以及访问外网的公网 IP，匿名使用以下服务:\n\nhttp://www.ip111.cn/ 获取 IP 信息.\nhttps://www.ipshudi.com 针对 ip111.cn 获取的 IP 信息,查询更加详细的信息.\n\n此外,也额外访问以下网址获取信息作为补充\n\nhttp://www.ip138.com 获取国内 IP 信息\nhttps://api.ip.sb/geoip 获取外网的详细 IP 信息\n\n![ip111.png](images/ip111.png)\n\n## Contributing\n\n1. Fork it (<https://github.com/crystal-china/myip/fork>)\n2. Create your feature branch (`git checkout -b my-new-feature`)\n3. Commit your changes (`git commit -am 'Add some feature'`)\n4. Push to the branch (`git push origin my-new-feature`)\n5. Create a new Pull Request\n\n## Contributors\n\n- [Billy.Zheng](https://github.com/zw963) - creator and maintainer\n","program":{"html_id":"myip/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"locations":[],"repository_name":"myip","program":true,"enum":false,"alias":false,"const":false,"types":[{"html_id":"myip/IP","path":"IP.html","kind":"alias","full_name":"IP","name":"IP","abstract":false,"locations":[{"filename":"src/myip.cr","line_number":10,"url":"https://github.com/crystal-china/myip/blob/v0.4.9/src/myip.cr#L10"}],"repository_name":"myip","program":false,"enum":false,"alias":true,"aliased":"String","aliased_html":"String","const":false},{"html_id":"myip/IPInfo","path":"IPInfo.html","kind":"alias","full_name":"IPInfo","name":"IPInfo","abstract":false,"locations":[{"filename":"src/myip.cr","line_number":9,"url":"https://github.com/crystal-china/myip/blob/v0.4.9/src/myip.cr#L9"}],"repository_name":"myip","program":false,"enum":false,"alias":true,"aliased":"String","aliased_html":"String","const":false},{"html_id":"myip/Myip","path":"Myip.html","kind":"class","full_name":"Myip","name":"Myip","abstract":false,"superclass":{"html_id":"myip/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"myip/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"myip/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/myip.cr","line_number":12,"url":"https://github.com/crystal-china/myip/blob/v0.4.9/src/myip.cr#L12"},{"filename":"src/myip/version.cr","line_number":1,"url":"https://github.com/crystal-china/myip/blob/v0.4.9/src/myip/version.cr#L1"}],"repository_name":"myip","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"VERSION","name":"VERSION","value":"{{ (`shards version \\\"/home/runner/work/myip/myip/src/myip\\\"`).chomp.stringify }}"}],"instance_methods":[{"html_id":"chan:Channel({String,String,String?})-instance-method","name":"chan","abstract":false,"location":{"filename":"src/myip.cr","line_number":13,"url":"https://github.com/crystal-china/myip/blob/v0.4.9/src/myip.cr#L13"},"def":{"name":"chan","visibility":"Public","body":"@chan"}},{"html_id":"chan_send_count:Int32-instance-method","name":"chan_send_count","abstract":false,"location":{"filename":"src/myip.cr","line_number":14,"url":"https://github.com/crystal-china/myip/blob/v0.4.9/src/myip.cr#L14"},"def":{"name":"chan_send_count","return_type":"Int32","visibility":"Public","body":"@chan_send_count"}},{"html_id":"chan_send_count=(chan_send_count:Int32)-instance-method","name":"chan_send_count=","abstract":false,"args":[{"name":"chan_send_count","external_name":"chan_send_count","restriction":"Int32"}],"args_string":"(chan_send_count : Int32)","args_html":"(chan_send_count : Int32)","location":{"filename":"src/myip.cr","line_number":14,"url":"https://github.com/crystal-china/myip/blob/v0.4.9/src/myip.cr#L14"},"def":{"name":"chan_send_count=","args":[{"name":"chan_send_count","external_name":"chan_send_count","restriction":"Int32"}],"visibility":"Public","body":"@chan_send_count = chan_send_count"}},{"html_id":"ip111_chan_send_count:Int32-instance-method","name":"ip111_chan_send_count","abstract":false,"location":{"filename":"src/myip.cr","line_number":15,"url":"https://github.com/crystal-china/myip/blob/v0.4.9/src/myip.cr#L15"},"def":{"name":"ip111_chan_send_count","return_type":"Int32","visibility":"Public","body":"@ip111_chan_send_count"}},{"html_id":"ip111_chan_send_count=(ip111_chan_send_count:Int32)-instance-method","name":"ip111_chan_send_count=","abstract":false,"args":[{"name":"ip111_chan_send_count","external_name":"ip111_chan_send_count","restriction":"Int32"}],"args_string":"(ip111_chan_send_count : Int32)","args_html":"(ip111_chan_send_count : Int32)","location":{"filename":"src/myip.cr","line_number":15,"url":"https://github.com/crystal-china/myip/blob/v0.4.9/src/myip.cr#L15"},"def":{"name":"ip111_chan_send_count=","args":[{"name":"ip111_chan_send_count","external_name":"ip111_chan_send_count","restriction":"Int32"}],"visibility":"Public","body":"@ip111_chan_send_count = ip111_chan_send_count"}},{"html_id":"ip_from_ib_sb-instance-method","name":"ip_from_ib_sb","abstract":false,"location":{"filename":"src/myip.cr","line_number":17,"url":"https://github.com/crystal-china/myip/blob/v0.4.9/src/myip.cr#L17"},"def":{"name":"ip_from_ib_sb","visibility":"Public","body":"self.chan_send_count = chan_send_count() + 1\nspawn do\n  begin\n    url = \"https://api.ip.sb/geoip\"\n    response = HTTP::Client.get(url)\n    body = response.body\n    result = JSON.parse(body)\n    io = IO::Memory.new\n    PrettyPrint.format(result, io, width: 79)\n    io.rewind\n    chan.send({\"#{url}：您访问外网地址信息：\", io.gets_to_end, nil})\n  rescue JSON::ParseException\n    chan.send({\"#{url}：\", body.not_nil!, nil})\n  rescue ex : ArgumentError | Socket::Error\n    chan.send({\"#{url}：\", ex.message.not_nil!, nil})\n  end\nend\n"}},{"html_id":"ip_from_ip111-instance-method","name":"ip_from_ip111","abstract":false,"location":{"filename":"src/myip.cr","line_number":36,"url":"https://github.com/crystal-china/myip/blob/v0.4.9/src/myip.cr#L36"},"def":{"name":"ip_from_ip111","visibility":"Public","body":"ip111_url = \"http://www.ip111.cn\"\ndoc, code = from_url(ip111_url)\ntitle = (doc.css(\".card-header\")).first.tag_text.strip\nipinfo = (doc.css(\".card-body p\")).first.tag_text.strip\nSTDERR.puts((\"#{ip111_url}：\".colorize(:yellow)).on_blue.bold, \"#{title}：#{ipinfo}\")\nheaders = HTTP::Headers {\"Referer\" => \"http://www.ip111.cn/\"}\n(doc.nodes(\"iframe\")).each do |node|\n  self.chan_send_count = chan_send_count() + 1\n  self.ip111_chan_send_count = ip111_chan_send_count() + 1\n  spawn do\n    begin\n      url = (node.attribute_by(\"src\")).not_nil!\n      doc, code = from_url(url, headers: headers)\n      title = (node.parent!.parent!.parent!.css(\".card-header\")).first.tag_text.strip\n      ipinfo = doc.body!.tag_text.strip\n      ip = ipinfo[/[a-z0-9:.]+/]\n      chan.send({\"#{ip111_url}：#{url}：\", \"#{title}：#{ipinfo}\", ip})\n    rescue ex : ArgumentError | Socket::Error\n      chan.send({\"#{ip111_url}：#{url}：\", ex.message.not_nil!, nil})\n    end\n  end\nend\n"}},{"html_id":"ip_from_ip138-instance-method","name":"ip_from_ip138","abstract":false,"location":{"filename":"src/myip.cr","line_number":69,"url":"https://github.com/crystal-china/myip/blob/v0.4.9/src/myip.cr#L69"},"def":{"name":"ip_from_ip138","visibility":"Public","body":"self.chan_send_count = chan_send_count + 1\nspawn do\n  begin\n    url = \"https://www.ip138.com\"\n    doc, _code = from_url(url, follow: true)\n    ip138_url = (doc.css(\"iframe\")).first.attribute_by(\"src\")\n    headers = HTTP::Headers {\"Origin\" => \"https://ip.skk.moe\"}\n    doc, code = from_url(\"https:#{ip138_url}\", headers: headers)\n    if code == 502\n      myip = (doc.css(\"body p span.F\")).first.tag_text[/IP:\\s*([0-9.]+)/, 1]\n      url = \"https://www.ip138.com/iplookup.php?ip=#{myip}\"\n      doc, _code = from_url(url, headers: headers)\n      output = String.build do |io|\n        (doc.css(\"div.table-box>table>tbody tr\")).each do |x|\n          io << x.tag_text\n        end\n      end\n      chan.send({\"#{url}：\", output.squeeze('\\n'), nil})\n    else\n      chan.send({\"#{url}：\", (doc.css(\"body p\")).first.tag_text.strip, nil})\n    end\n  rescue ex : ArgumentError | Socket::Error\n    chan.send({\"#{url}：\", ex.message.not_nil!, nil})\n  end\nend\n"}},{"html_id":"process-instance-method","name":"process","abstract":false,"location":{"filename":"src/myip.cr","line_number":98,"url":"https://github.com/crystal-china/myip/blob/v0.4.9/src/myip.cr#L98"},"def":{"name":"process","visibility":"Public","body":"detail_chan = Channel(Tuple(String, String)).new\nchan_send_count.times do\n  select\n  when value = chan.receive\n    title, ipinfo, ip = value\n    STDERR.puts(\"#{(title.colorize(:yellow)).on_blue.bold}\\n#{ipinfo}\")\n    if !ip.nil?\n      spawn do\n        details_ip_url = \"https://www.ipshudi.com/#{ip}.htm\"\n        doc, _code = from_url(details_ip_url)\n        output = String.build do |io|\n          (doc.css(\"div.ft>table>tbody>tr>td\")).each do |x|\n            io << x.tag_text\n          end\n        end\n        detail_chan.send({\"Checking #{ip} use ipshudi.com：\", output.squeeze('\\n')})\n      end\n    end\n  when timeout(5.seconds)\n    STDERR.puts(\"Timeout, check your network connection!\")\n    exit\n  end\nend\nip111_chan_send_count.times do\n  select\n  when value = detail_chan.receive\n    title, ipinfo = value\n    STDERR.puts(\"#{(title.colorize(:yellow)).on_blue.bold}\\n#{ipinfo}\")\n  end\nend\n"}}]},{"html_id":"myip/Title","path":"Title.html","kind":"alias","full_name":"Title","name":"Title","abstract":false,"locations":[{"filename":"src/myip.cr","line_number":8,"url":"https://github.com/crystal-china/myip/blob/v0.4.9/src/myip.cr#L8"}],"repository_name":"myip","program":false,"enum":false,"alias":true,"aliased":"String","aliased_html":"String","const":false}]}})